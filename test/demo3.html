<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—èªé»æ“Šå­¸ç¿’ Demo (MVP)</title>
    <style>
        /* ä¿æŒåŸæœ‰æ¨£å¼ï¼Œæ²’æœ‰è®ŠåŒ– */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f4f4f9;
            color: #333;
        }
        #game-container {
            width: 90%;
            max-width: 600px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        #progress-bar {
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        #progress {
            height: 100%;
            width: 0%;
            background-color: #4CAF50;
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        #audio-hint {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #333;
        }
        #options-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 30px;
        }
        .option-block {
            padding: 20px 10px;
            background-color: #007bff;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            /* æ¨¡æ“¬åœ–ç‰‡å€å¡Šï¼Œå¯¦éš›å°ˆé¡Œä¸­æœƒæ›¿æ›æˆ <img src="..."> */
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .option-block:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        /* éŒ¯èª¤é»æ“Šçš„åé¥‹æ¨£å¼ */
        .wrong-answer {
            animation: shake 0.5s;
            background-color: #dc3545 !important;
        }
        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            20%, 60% {transform: translateX(-10px);}
            40%, 80% {transform: translateX(10px);}
        }
        .final-screen {
            font-size: 1.5em;
            color: #28a745;
            margin-top: 50px;
        }
        #replay-button {
            padding: 10px 20px;
            margin-top: 20px;
            background-color: #ffc107;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        #mode-selector {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        #mode-selector label {
            margin-right: 15px;
            font-weight: bold;
        }
        #mode-selector input[type="radio"] {
            margin-right: 5px;
        }
        #mode-selector input[type="radio"]:checked + label {
            color: #007bff;
        }
    </style>
</head>
<body>

<div id="game-container">
    <h1>æ—èªå­¸ç¿’éŠæˆ² Demo</h1>
    <div id="mode-selector">
        <label>å‡ºé¡Œæ¨¡å¼ï¼š</label>
        <input type="radio" id="mode-sequential" name="game-mode" value="sequential" checked>
        <label for="mode-sequential">é †åºæ¨¡å¼</label>
        <input type="radio" id="mode-random" name="game-mode" value="random">
        <label for="mode-random">éš¨æ©Ÿæ¨¡å¼</label>
    </div>
    <div id="progress-bar"><div id="progress"></div></div>
    
    <div id="audio-hint">è«‹é¸æ“‡æ¨¡å¼ä¸¦é»æ“Šå–‡å­åœ–æ¨™é–‹å§‹éŠæˆ²ã€‚</div>

    <button id="play-button" onclick="playAudio()" style="padding: 15px; font-size: 1.5em; cursor: pointer; background-color: #6c757d; color: white; border: none; border-radius: 50%;">ğŸ”Š</button>

    <div id="options-container">
        </div>
    
    <div id="feedback" style="margin-top: 20px; font-size: 1.2em;"></div>
</div>

<script>
// ----------------------------------------------------------------------
// æ­¥é©Ÿ 1: éŠæˆ²è³‡æ–™è¨­å®š - **å·²ç§»é™¤å›ºå®šçš„ options é™£åˆ—**
// ----------------------------------------------------------------------
const gameData = [
    { word: "åª½åª½", audioFile: "mama.mp3", correctText: "åª½åª½" }, 
    { word: "èŠ‹é ­", audioFile: "taro.mp3", correctText: "èŠ‹é ­" },
    { word: "å¤ªé™½", audioFile: "sun.mp3", correctText: "å¤ªé™½" },
    // **å»ºè­°ï¼šæœªä¾†è«‹åœ¨é€™è£¡æ–°å¢æ›´å¤šé¡Œç›®ï¼Œè®“æ“¾äº‚é¸é …æ›´è±å¯Œï¼**
    // { word: "çˆ¸çˆ¸", audioFile: "baba.mp3", correctText: "çˆ¸çˆ¸" }, 
    // { word: "æ°´", audioFile: "water.mp3", correctText: "æ°´" }
];

// ----------------------------------------------------------------------
// æ­¥é©Ÿ 2: éŠæˆ²ç‹€æ…‹è®Šæ•¸
// ----------------------------------------------------------------------
let currentLevel = 0; 
let currentGameData = []; 
const totalOriginalLevels = gameData.length; 

const optionsContainer = document.getElementById('options-container');
const progressElement = document.getElementById('progress');
const feedbackElement = document.getElementById('feedback');
const audioHintElement = document.getElementById('audio-hint');
const playButton = document.getElementById('play-button');
let currentAudio = null;

// ----------------------------------------------------------------------
// æ­¥é©Ÿ 3: é€šç”¨å‡½å¼ (åŒ…å«éš¨æ©Ÿæ’åºå’Œå‹•æ…‹é¸é …ç”Ÿæˆ)
// ----------------------------------------------------------------------
// éš¨æ©Ÿæ‰“äº‚é™£åˆ—ï¼ˆFisher-Yates shuffle æ¼”ç®—æ³•ï¼‰
function shuffleArray(array) {
    const shuffled = [...array]; 
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

/**
 * æ ¹æ“šæ­£ç¢ºç­”æ¡ˆï¼Œå‹•æ…‹ç”ŸæˆåŒ…å«æ“¾äº‚é¸é …çš„æœ€çµ‚é¸é …åˆ—è¡¨
 * @param {string} correctWord - ç•¶å‰é—œå¡çš„æ­£ç¢ºç­”æ¡ˆæ–‡å­—
 * @returns {Array} åŒ…å« 3 å€‹é¸é …çš„é™£åˆ— (1æ­£ç¢º, 2æ“¾äº‚, ä¸”é †åºæ‰“äº‚)
 */
function getDistractorOptions(correctWord) {
    // å–å¾—æ‰€æœ‰é¡Œç›®ä¸­çš„å–®å­—åˆ—è¡¨
    const allWords = gameData.map(data => data.word); 

    // éæ¿¾æ‰æ­£ç¢ºç­”æ¡ˆï¼Œå¾—åˆ°æ‰€æœ‰å¯èƒ½çš„æ“¾äº‚é¸é …
    let distractors = allWords.filter(word => word !== correctWord); 
    
    // å¦‚æœæ“¾äº‚é¸é …ä¸è¶³ 2 å€‹ï¼Œå‰‡ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„æ“¾äº‚é¸é …
    const numDistractorsNeeded = Math.min(2, distractors.length);
    
    // å°‡æ“¾äº‚é¸é …æ‰“äº‚ä¸¦é¸å–æ‰€éœ€çš„æ•¸é‡
    distractors = shuffleArray(distractors).slice(0, numDistractorsNeeded); 
    
    // ç¢ºä¿é¸é …è‡³å°‘æœ‰ 3 å€‹ (æ­£ç¢º + 2æ“¾äº‚)ï¼Œå¦‚æœé¡Œç›®å¤ªå°‘ï¼Œå¯èƒ½å°‘æ–¼ 3 å€‹
    
    // çµ„åˆæ­£ç¢ºç­”æ¡ˆå’Œæ“¾äº‚é¸é …
    let options = [
        { text: correctWord, isCorrect: true }
    ];

    distractors.forEach(word => {
        options.push({ text: word, isCorrect: false });
    });

    // å¦‚æœç¸½é¸é …æ•¸ä¸è¶³ 3 å€‹ï¼Œå¡«å……ç©ºç™½é¸é … (ç•¶é¡Œç›®æ•¸é‡å¤ªå°‘æ™‚ç™¼ç”Ÿ)
    while (options.length < 3) {
        options.push({ text: 'éŒ¯èª¤é¸é …' + options.length, isCorrect: false });
    }

    // æœ€çµ‚å°‡æ•´å€‹é¸é …åˆ—è¡¨æ‰“äº‚ï¼Œé¿å…æ­£ç¢ºç­”æ¡ˆç¸½æ˜¯åœ¨ç¬¬ä¸€å€‹ä½ç½®
    return shuffleArray(options);
}

// ----------------------------------------------------------------------
// æ­¥é©Ÿ 4: æ ¸å¿ƒåŠŸèƒ½ - æ’­æ”¾éŸ³æª” (ä¿æŒä¸è®Š)
// ----------------------------------------------------------------------
function playAudio() {
    if (currentLevel >= currentGameData.length) return;
    
    const currentData = currentGameData[currentLevel];
    
    // --- å¯¦éš›å°ˆé¡Œæ›¿æ›ç¨‹å¼ç¢¼ï¼šæ’­æ”¾éŸ³æª” ---
    const audioPath = 'audio/' + currentData.audioFile;
    currentAudio = new Audio(audioPath);

    currentAudio.play().catch(error => {
        console.error("Audio playback failed:", error);
        alert("èªéŸ³æ’­æ”¾å¤±æ•—ï¼Œè«‹ç¢ºèªéŸ³æª”æª”æ¡ˆåç¨±èˆ‡è·¯å¾‘æ˜¯å¦æ­£ç¢ºï¼Œæˆ–åœ¨ç•«é¢ä¸Šé»æ“Šä¸€ä¸‹ã€‚");
    });
    // ------------------------------------------

    audioHintElement.textContent = `è«‹æ ¹æ“šæ‚¨è½åˆ°çš„æ—èªï¼Œé»æ“Šå°æ‡‰çš„åœ–ç‰‡æ–¹å¡Šã€‚`;
    playButton.disabled = true;
    setTimeout(() => { playButton.disabled = false; }, 2500);
}

// ----------------------------------------------------------------------
// æ­¥é©Ÿ 5: æ ¸å¿ƒåŠŸèƒ½ - æª¢æŸ¥ç­”æ¡ˆèˆ‡åˆ‡æ› (ä¿æŒä¸è®Š)
// ----------------------------------------------------------------------
function checkAnswer(isCorrect, blockElement) {
    if (currentLevel >= currentGameData.length) return;

    if (isCorrect) {
        feedbackElement.textContent = "âœ… ç­”å°äº†ï¼é€²å…¥ä¸‹ä¸€é—œï¼";
        setTimeout(nextLevel, 1000); 
    } else {
        feedbackElement.textContent = "âŒ ç­”éŒ¯äº†ï¼è«‹å†è½ä¸€æ¬¡ã€‚";
        blockElement.classList.add('wrong-answer');
        
        setTimeout(() => {
            blockElement.classList.remove('wrong-answer');
        }, 500);
        
        setTimeout(playAudio, 1000); 
    }
}

function nextLevel() {
    currentLevel++;
    renderLevel();
}

// ----------------------------------------------------------------------
// æ­¥é©Ÿ 6: æ¸²æŸ“é—œå¡ - **ä½¿ç”¨å‹•æ…‹é¸é …**
// ----------------------------------------------------------------------
function renderLevel() {
    if (currentLevel >= currentGameData.length) {
        // ... (éŠæˆ²çµæŸé‚è¼¯ä¿æŒä¸è®Š) ...
        optionsContainer.innerHTML = `<div class="final-screen">æ­å–œï¼å·²å®Œæˆæ‰€æœ‰é—œå¡ï¼<br> å°ˆé¡Œ Demo 1 </div>`;
        feedbackElement.textContent = "";
        playButton.style.display = 'none';
        audioHintElement.textContent = "é»æ“Šä¸‹æ–¹çš„æŒ‰éˆ•é‡æ–°é–‹å§‹ã€‚";
        
        const restartButton = document.createElement('button');
        restartButton.id = 'replay-button';
        restartButton.textContent = 'é‡æ–°é–‹å§‹';
        restartButton.onclick = startGame; 
        optionsContainer.appendChild(restartButton);
        
        updateProgress();
        return;
    }

    const currentData = currentGameData[currentLevel];
    optionsContainer.innerHTML = ''; 
    feedbackElement.textContent = "";
    playButton.style.display = 'block';

    // ğŸ”‘ é—œéµæ­¥é©Ÿï¼šå‹•æ…‹ç”Ÿæˆå¸¶æœ‰æ“¾äº‚é¸é …çš„åˆ—è¡¨
    const dynamicOptions = getDistractorOptions(currentData.word);

    // æ¸²æŸ“é¸é …æ–¹å¡Š
    dynamicOptions.forEach(option => {
        const block = document.createElement('div');
        block.classList.add('option-block');
        block.textContent = option.text; // Demo ä½¿ç”¨æ–‡å­—
        
        // ç¶å®šé»æ“Šäº‹ä»¶ï¼Œä½¿ç”¨å‹•æ…‹ç”Ÿæˆçš„ isCorrect å±¬æ€§
        block.onclick = () => checkAnswer(option.isCorrect, block);
        
        optionsContainer.appendChild(block);
    });

    updateProgress();
    playAudio(); 
}

// ----------------------------------------------------------------------
// æ­¥é©Ÿ 7: é€²åº¦æ¢æ›´æ–° (ä¿æŒä¸è®Š)
// ----------------------------------------------------------------------
function updateProgress() {
    const percentage = (currentLevel / currentGameData.length) * 100; 
    progressElement.style.width = `${percentage}%`;
}

// ----------------------------------------------------------------------
// æ­¥é©Ÿ 8: éŠæˆ²å•Ÿå‹•èˆ‡æ¨¡å¼ç®¡ç† (ä¿æŒä¸è®Š)
// ----------------------------------------------------------------------
function startGame() {
    const modeSelector = document.querySelector('input[name="game-mode"]:checked');
    const isRandom = modeSelector && modeSelector.value === 'random';

    if (isRandom) {
        currentGameData = shuffleArray(gameData);
        audioHintElement.textContent = "å·²è¨­å®šç‚ºéš¨æ©Ÿæ¨¡å¼ï¼Œè«‹é»æ“Šå–‡å­åœ–æ¨™é–‹å§‹ã€‚";
    } else {
        currentGameData = [...gameData]; 
        audioHintElement.textContent = "å·²è¨­å®šç‚ºé †åºæ¨¡å¼ï¼Œè«‹é»æ“Šå–‡å­åœ–æ¨™é–‹å§‹ã€‚";
    }
    
    currentLevel = 0;
    renderLevel();
}

document.addEventListener('DOMContentLoaded', function() {
    const modeInputs = document.querySelectorAll('input[name="game-mode"]');
    modeInputs.forEach(input => {
        input.addEventListener('change', startGame);
    });
    
    startGame();
});
</script>
</body>
</html>